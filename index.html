<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>نظام التقارير المدرسية</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // ألوان موف + تركوازي
    tailwind.config = {
      theme: {
        extend: {
          colors:{
            primary:"#7C3AED", // موف
            primaryDark:"#6D28D9",
            accent:"#14B8A6",  // تركوازي
            accentDark:"#0D9488"
          },
          boxShadow:{
            soft:"0 10px 25px rgba(0,0,0,.06)"
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
    body{font-family:'Cairo',sans-serif;background:linear-gradient(180deg,#faf7ff, #f0fffb);}
    .tab-active{background:#fff;border-color:#7C3AED;color:#7C3AED}
    .glass{backdrop-filter:saturate(180%) blur(10px);}
    @media print{
      .no-print{display:none!important}
      body{background:#fff}
      .card{box-shadow:none!important;border:0!important}
    }
  </style>
</head>
<body class="min-h-screen text-gray-800">

  <!-- شريط علوي -->
  <header class="no-print sticky top-0 z-40 glass bg-white/70 border-b">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-accent grid place-items-center text-white font-bold">SR</div>
      <div>
        <h1 class="text-xl sm:text-2xl font-bold text-primary">نظام التقارير المدرسية</h1>
        <p class="text-xs sm:text-sm text-gray-600">اليومي • الأسبوعي • الشهري • النشاط • تواصل وليّ الأمر • حصة الانتظار</p>
      </div>
      <div class="ms-auto hidden sm:flex items-center gap-2 text-xs text-gray-500">
        <span>الثانوية الثانية والخمسون</span>
        <span class="w-1 h-1 rounded-full bg-gray-300"></span>
        <span>منسقة التميز: فاطمة سعد العمري</span>
      </div>
    </div>

    <!-- تبويبات -->
    <nav class="border-t bg-white/60">
      <div class="max-w-6xl mx-auto px-2 sm:px-4">
        <div id="tabs" class="flex overflow-x-auto gap-2 py-2">
          <button class="tab btn" data-tab="daily">اليومي</button>
          <button class="tab btn" data-tab="weekly">الأسبوعي</button>
          <button class="tab btn" data-tab="monthly">الشهري</button>
          <button class="tab btn" data-tab="activity">برامج النشاط</button>
          <button class="tab btn" data-tab="nonclass">الأنشطة اللاصفّية</button>
          <button class="tab btn" data-tab="parent">تواصل وليّ الأمر</button>
          <button class="tab btn" data-tab="waiting">حصة الانتظار</button>
        </div>
      </div>
    </nav>
  </header>

  <!-- أزرار الإجراء -->
  <section class="no-print max-w-6xl mx-auto px-4 pt-4">
    <div class="flex flex-wrap gap-2">
      <button id="btnSave" class="px-4 py-2 rounded-md text-white bg-primary hover:bg-primaryDark shadow-soft">حفظ سجل محليًا</button>
      <button id="btnExport" class="px-4 py-2 rounded-md text-white bg-accent hover:bg-accentDark shadow-soft">طباعة / حفظ PDF</button>
      <button id="btnClear" class="px-4 py-2 rounded-md bg-white border hover:bg-gray-50 shadow-soft">مسح المدخلات</button>
      <!-- زر اختياري سيرسل للشيت لو أضفتِ Web App -->
      <!-- <button id="btnSend" class="px-4 py-2 rounded-md text-white bg-black">إرسال إلى Google Sheets</button> -->
    </div>
  </section>

  <!-- المحتوى -->
  <main class="max-w-6xl mx-auto p-4">
    <div class="card bg-white rounded-2xl shadow-soft border">
      <div class="p-4 sm:p-6 border-b bg-gradient-to-l from-white to-purple-50/40 rounded-t-2xl">
        <h2 id="formTitle" class="text-lg sm:text-xl font-bold text-primary">نموذج التقرير اليومي</h2>
        <p class="text-xs sm:text-sm text-gray-600 mt-1">املئي الحقول التالية ثم اضغطي “حفظ سجل”.</p>
      </div>

      <form id="reportForm" class="p-4 sm:p-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- مشتركة -->
        <div>
          <label class="block text-sm mb-1">التاريخ</label>
          <input type="date" name="date" class="w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-primary/30" required>
        </div>
        <div>
          <label class="block text-sm mb-1">اسم المعلمة</label>
          <input type="text" name="teacher" placeholder="اكتبي اسم المعلمة" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-primary/30" required>
        </div>
        <div>
          <label class="block text-sm mb-1">المادة / البرنامج</label>
          <input type="text" name="subject" placeholder="مثال: رياضيات / نادي STEM" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-primary/30">
        </div>
        <div>
          <label class="block text-sm mb-1">الصف / القسم</label>
          <input type="text" name="grade" placeholder="2 ث/أ" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-primary/30">
        </div>
        <div>
          <label class="block text-sm mb-1">عدد الحاضرات</label>
          <input type="number" min="0" name="presentCount" placeholder="مثال: 28" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-primary/30">
        </div>
        <div>
          <label class="block text-sm mb-1">روابط صور/مرفقات</label>
          <input type="url" name="attachments" placeholder="رابط Google Drive / صور" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-primary/30">
        </div>
        <div class="sm:col-span-2">
          <label class="block text-sm mb-1">وصف موجز</label>
          <textarea name="summary" rows="3" placeholder="ملخص التنفيذ والفعاليات…" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-primary/30"></textarea>
        </div>
        <div class="sm:col-span-2">
          <label class="block text-sm mb-1">نواتج التعلم / الأثر</label>
          <textarea name="outcomes" rows="3" placeholder="ما الذي تحقق؟ مؤشرات، شواهد…" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-primary/30"></textarea>
        </div>

        <!-- حقول خاصة بكل تبويب -->
        <div id="tabSpecific" class="sm:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
      </form>

      <div class="px-4 sm:px-6 pb-6">
        <div class="flex items-center gap-2 text-sm text-gray-600 mb-2">
          <span class="w-1.5 h-1.5 rounded-full bg-accent"></span> السجلات المحفوظة محليًا
        </div>
        <div id="savedList" class="grid gap-3"></div>
      </div>

      <footer class="px-4 sm:px-6 py-4 bg-gray-50/70 rounded-b-2xl text-sm text-gray-600">
        <div class="flex flex-wrap items-center gap-2">
          <span>© <span id="year"></span> الثانوية الثانية والخمسون</span>
          <span class="w-1 h-1 rounded-full bg-gray-300"></span>
          <span>إعداد: فاطمة سعد العمري — إشراف: أ. أسماء القرشي</span>
        </div>
      </footer>
    </div>
  </main>

  <script>
    const $ = s => document.querySelector(s);
    const tabs = document.querySelectorAll('.tab');
    const form = $('#reportForm');
    const tabSpecific = $('#tabSpecific');
    const savedList = $('#savedList');
    const formTitle = $('#formTitle');
    const storageKey = 'school-reports-v2';
    let activeTab = 'daily';

    // زر تبويب أنيق
    document.querySelectorAll('.btn').forEach(b=>{
      b.className = "tab px-3 py-2 rounded-lg border text-sm bg-white hover:bg-gray-50";
    });

    // حقول خاصة لكل تبويب
    const tabFields = {
      daily: [
        {name:'lesson', label:'موضوع الدرس', type:'text', placeholder:'مثال: خصائص الأعداد الحقيقية'},
        {name:'homework', label:'الواجب / المتابعة', type:'text', placeholder:'تم تسليم/متابعة الواجب…'}
      ],
      weekly: [
        {name:'weekNo', label:'أسبوع رقم', type:'number', placeholder:'مثال: 2'},
        {name:'goals', label:'أبرز أهداف الأسبوع', type:'textarea', placeholder:'الأهداف التنفيذية للأسبوع…'}
      ],
      monthly: [
        {name:'month', label:'الشهر', type:'text', placeholder:'مثال: محرم 1447 / سبتمبر'},
        {name:'kpis', label:'مؤشرات الأداء (KPIs)', type:'textarea', placeholder:'نسبة إنجاز، حضور، متوسط درجات…'}
      ],
      activity: [
        {name:'programName', label:'اسم البرنامج', type:'text', placeholder:'مثال: مسابقة موهبة'},
        {name:'partners', label:'شركاء / جهات مشاركة', type:'text', placeholder:'مثال: نادي الموهوبات'}
      ],
      nonclass: [
        {name:'activityType', label:'نوع النشاط اللاصفي', type:'text', placeholder:'مثال: نادي القراءة'},
        {name:'duration', label:'المدة', type:'text', placeholder:'مثال: 45 دقيقة'}
      ],
      parent: [
        {name:'guardian', label:'اسم وليّ الأمر', type:'text', placeholder:'اسم ولي الأمر'},
        {name:'message', label:'ملخص التواصل', type:'textarea', placeholder:'نص الاتصال / الرسالة / الملاحظة'}
      ],
      waiting: [
        {name:'period', label:'الحصة', type:'text', placeholder:'مثال: الحصة الرابعة'},
        {name:'reason', label:'السبب / خطة الاستفادة', type:'textarea', placeholder:'سبب الانتظار وخطة الاستفادة من الوقت'}
      ]
    };

    function setYear(){ $('#year').textContent = new Date().getFullYear(); }
    setYear();

    function renderTabSpecific(tab){
      tabSpecific.innerHTML = '';
      (tabFields[tab]||[]).forEach(f=>{
        const wrap = document.createElement('div');
        const lbl = document.createElement('label');
        lbl.className = 'block text-sm mb-1';
        lbl.textContent = f.label;
        let input;
        if(f.type==='textarea'){
          input = document.createElement('textarea'); input.rows=3;
        }else{
          input = document.createElement('input'); input.type=f.type||'text';
        }
        input.name=f.name;
        input.placeholder=f.placeholder||'';
        input.className='w-full border rounded-lg p-2 focus:ring-2 focus:ring-primary/30';
        wrap.appendChild(lbl); wrap.appendChild(input);
        tabSpecific.appendChild(wrap);
      });
    }

    function activateTab(tab){
      activeTab = tab;
      document.querySelectorAll('.tab').forEach(b=>{
        const on = b.dataset.tab===tab;
        b.classList.toggle('tab-active', on);
        b.classList.toggle('border-primary', on);
      });
      const titles = {
        daily:'نموذج التقرير اليومي',
        weekly:'نموذج التقرير الأسبوعي',
        monthly:'نموذج التقرير الشهري',
        activity:'نموذج برامج النشاط',
        nonclass:'نموذج الأنشطة اللاصفّية',
        parent:'نموذج تواصل وليّ الأمر',
        waiting:'نموذج تقرير حصة الانتظار'
      };
      formTitle.textContent = titles[tab] || 'نموذج التقرير';
      renderTabSpecific(tab);
      loadDraft();
      renderSaved();
    }
    document.querySelectorAll('.tab').forEach(b=>b.addEventListener('click',()=>activateTab(b.dataset.tab)));
    activateTab('daily');

    // تخزين محلي
    function loadAll(){ try{ return JSON.parse(localStorage.getItem(storageKey))||{} }catch{ return {} } }
    function saveAll(d){ localStorage.setItem(storageKey, JSON.stringify(d)); }
    function getFormData(){ const d={_tab:activeTab}; new FormData(form).forEach((v,k)=>d[k]=v); return d; }
    function setFormData(o={}){
      [...form.elements].forEach(el=>{
        if(!el.name) return;
        el.value = (o.hasOwnProperty(el.name) ? o[el.name] : '');
      });
    }
    function saveDraft(){ const all=loadAll(); all[`draft_${activeTab}`]=getFormData(); saveAll(all); }
    function loadDraft(){ const all=loadAll(); setFormData(all[`draft_${activeTab}`]||{}); }

    function saveRecord(){
      const all = loadAll();
      const key = `records_${activeTab}`;
      all[key] = all[key] || [];
      const record = getFormData(); record._id=Date.now();
      all[key].unshift(record);
      all[`draft_${activeTab}`] = {};
      saveAll(all);
      setFormData({});
      renderSaved();
      alert('تم الحفظ محليًا ✅');
    }

    function renderSaved(){
      const all = loadAll();
      const key = `records_${activeTab}`;
      const items = all[key] || [];
      savedList.innerHTML = '';
      if(!items.length){ savedList.innerHTML='<div class="text-gray-500 text-sm">لا توجد سجلات محفوظة لهذا التبويب.</div>'; return; }
      items.forEach(r=>{
        const div = document.createElement('div');
        div.className='border rounded-xl p-3 bg-white/80 hover:bg-gray-50 transition shadow-sm';
        const head = `${r.date||'—'} • ${r.teacher||'—'} • ${r.subject||'—'}`;
        div.innerHTML = `
          <div class="text-sm font-semibold text-primary">${head}</div>
          <div class="text-xs text-gray-600 mt-0.5">الصف: ${r.grade||'—'} | الحضور: ${r.presentCount||'—'}</div>
          <div class="text-sm mt-1">${(r.summary||'').slice(0,160)}${(r.summary||'').length>160?'…':''}</div>
          <div class="flex gap-3 pt-2 text-sm">
            <button class="text-accentDark underline" data-action="fill">فتح</button>
            <button class="text-red-600 underline" data-action="del">حذف</button>
          </div>
        `;
        div.querySelector('[data-action="fill"]').onclick=()=>{
          setFormData(r); saveDraft(); window.scrollTo({top:0,behavior:'smooth'});
        };
        div.querySelector('[data-action="del"]').onclick=()=>{
          const all2=loadAll(); all2[key]=(all2[key]||[]).filter(x=>x._id!==r._id); saveAll(all2); renderSaved();
        };
        savedList.appendChild(div);
      });
    }

    // أزرار
    $('#btnSave').addEventListener('click', saveRecord);
    $('#btnExport').addEventListener('click', ()=>{ saveDraft(); window.print(); });
    $('#btnClear').addEventListener('click', ()=>{ setFormData({}); saveDraft(); });
    form.addEventListener('input', saveDraft);

    // تكامل Google Sheets (اختياري)
    const APPS_SCRIPT_URL = ""; // ضعي رابط الـ Web App هنا لو أردتِ الإرسال للشيت
    async function sendToSheet(record){
      if(!APPS_SCRIPT_URL){ alert('أضيفي رابط Web App في APPS_SCRIPT_URL'); return; }
      try{
        const res = await fetch(APPS_SCRIPT_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(record)});
        const data = await res.json();
        alert(data.status==='ok'?'تم الإرسال إلى Google Sheets ✅':'حدثت مشكلة أثناء الإرسال');
      }catch(e){ alert('فشل الاتصال: '+e.message); }
    }
    // document.getElementById('btnSend')?.addEventListener('click', ()=>sendToSheet(getFormData()));
  </script>
</body>
</html>
